# AI開発用 Todoリスト：日記アプリ（Nikki2ベース・JS分割版）

## Phase 1: プロジェクト基盤と画面遷移（Router）
まず、画面の器と行き来する仕組みを作り、開発中にいつでも画面を確認できるようにする。

- [ ] **ファイル構成とJS設計**:
    - ファイルを機能ごとに分割する（例: `index.html`, `css/style.css`, `js/main.js`, `js/auth.js`, `js/ui.js`, `js/firebase.js`）。
    - **JS構造の定義**:
        - `View`: 画面の表示・非表示の切り替え、DOM操作
        - `Auth`: ログイン認証管理
        - `Store`: Firebaseとの通信（Firestore/Storage）
        - `App`: 全体のステート管理（現在の日付、ユーザー情報）
- [ ] **UIベース構築（`nikki2.html`の移植）**:
    - `index.html` に「設定画面」「カレンダー画面」「入力画面」の全セクションを作成し、IDを振る。
    - CSSを適用し、見た目を整える。
    - 提供された `nikki2.html` のHTMLとCSSをベースに、アプリのメイン画面（入力・編集画面）を構築する。
    - CSS変数を活用し、パステルカラー（`--primary-orange` 等）やレスポンシブ対応を適用する。
- [ ] **ナビゲーション実装（Router）**:
    - `js/ui.js` に `showScreen(screenId)` 関数を作る（指定した画面以外を`display: none`にする）。
    - **メニューボタンの実装**: 左上のハンバーガーメニューを押し、「今日」「カレンダー（今まで）」を押すと即座に画面が切り替わるように、この段階で実装する。
    - **仮の動作確認**: 日付クリック等のロジックなしで、ボタン操作だけで画面が行き来できることを確認する。

## Phase 2: Firebase設定と認証 (Auth)
- [ ] **設定画面ロジック**:
    - `js/auth.js` に実装。
    - 設定フォーム（API Key等）の入力を受け取り、`localStorage` へ保存/読み出しする処理。
- [ ] **認証フロー**:
    - アプリ起動時 (`main.js`) に設定を確認し、未設定なら「設定画面」へ、設定済みならログイン試行。
    - ログイン成功時に `View.showScreen('calendar')` または `View.showScreen('editor')` を呼ぶ。

## Phase 3: カレンダー機能 (Calendar Logic)
保存データの読み書きの前に、まずカレンダーが動くようにする。

- [ ] **カレンダー描画ロジック**:
    - `js/ui.js` または `js/calendar.js` に実装。
    - 指定された「年・月」のカレンダーグリッドを生成する関数を作成。
    - 前月・次月ボタンで表示月を再描画する処理。
- [ ] **日付選択の挙動**:
    - 日付セルをクリックした際、グローバル変数 `currentDate` を更新し、入力画面へ遷移するイベントリスナーを設定。

## Phase 4: データ保存と読込 (Store/Firebase)
- [ ] **データスキーマ定義**:
    - `js/firebase.js` にFirestoreとStorageの関数を集約する。
- [ ] **保存処理 (Save)**:
    - **画像処理**: Canvasを使ったリサイズ処理関数を実装。
    - **Upload & Set**: 入力画面の「保存」ボタン押下で、画像をStorageへ、データをFirestoreへ保存する。
    - 保存成功後、`View.showScreen('calendar')` を呼び出す。
- [ ] **読込処理 (Load)**:
    - **カレンダー反映**: 月ごとのデータを取得し、カレンダーの日付セルに「ハイライト色」を反映させる。
    - **記事反映**: 日付選択時、その日のデータがあれば入力画面に値をセット（編集モード）、なければ空にする（新規モード）。

## Phase 5: 仕上げと統合テスト
- [ ] **削除機能**:
    - 編集モード時のみ削除ボタンを表示し、Firestoreから削除してカレンダーへ戻る処理。
- [ ] **エラーハンドリング**:
    - 通信エラーや未入力時のアラート表示。
- [ ] **最終デザイン調整**:
    - レスポンシブ対応の微調整、ローディング表示の追加など。

---

### （参考）JavaScriptの構成イメージ
AIにコードを書かせる際、以下のファイル分割（またはクラス分割）を指定するとスムーズです。

1.  **`utils.js`**: 画像リサイズ、日付フォーマット変換などの便利関数。
2.  **`firebaseManager.js`**: Firebase SDKの初期化、Firestore/StorageへのCRUD操作のみを行う。UIには触らない。
3.  **`uiManager.js`**: 画面の切り替え（`showPage`）、カレンダーのHTML生成、フォームへの値のセット・取得を行う。ロジックは持たない。
4.  **`authManager.js`**: ログイン、設定情報のローカルストレージ管理。
5.  **`main.js`**: アプリの初期化。上記3つを統括し、「ボタンが押されたら→Firebaseに保存して→UIを更新する」といった指令を出す司令塔。